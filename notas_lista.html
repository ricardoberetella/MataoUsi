<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notas Fiscais</title>

<link rel="stylesheet" href="css/global.css">
<link rel="stylesheet" href="css/pedidos_lista.css">

<style>

/* ===================================================
   ESCONDER TEXTO DE IMPRESSÃO NO MODO TELA (SOLUÇÃO 1)
   =================================================== */
.print-header,
.print-info,
.print-title {
  display: none;
}

/* MODAL FATURAMENTO */
.modal-faturamento {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.7);
}

.modal-content {
  background-color: #1e293b;
  margin: 10% auto;
  padding: 20px;
  border: 1px solid #334155;
  width: 350px;
  border-radius: 8px;
  color: white;
}

.modal-header { border-bottom: 1px solid #334155; padding-bottom: 10px; margin-bottom: 15px; }
.form-group { margin-bottom: 15px; }
.form-group label { display: block; margin-bottom: 5px; font-size: 14px; }
.form-group select, .form-group input { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #334155; background: #0f172a; color: white; }
.btn-calc { width: 100%; padding: 10px; background: #0ea5e9; border: none; color: white; border-radius: 4px; cursor: pointer; font-weight: bold; }
.resultado-faturamento { margin-top: 20px; padding: 15px; background: #0f172a; border-radius: 4px; text-align: center; border: 1px dashed #0ea5e9; }

/* ===================================================
   IMPRESSÃO
   =================================================== */
@media print {

  body { background:#fff !important; color:#000 !important; }

  header, .acoes, button, th:last-child, td:last-child, .modal-faturamento {
    display:none !important;
  }

  .container, .card {
    border:none !important;
    box-shadow:none !important;
    margin:0 !important;
    padding:0 !important;
  }

  /* Cabeçalho do print */
  .print-header {
    display:flex !important;
    align-items:flex-start !important;
    gap:15px !important;
    margin:0 0 10px 0 !important;
  }

  .print-logo-box {
    width:190px !important;
    height:55px !important;
    background-repeat:no-repeat !important;
    background-size:contain !important;
    background-position:left top !important;

    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;

    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='380' height='110'%3E%3Crect width='100%25' height='100%25' fill='white'/%3E%3Ctext x='0' y='70' font-family='Arial' font-size='44' font-weight='700' fill='black'%3EMAT%C3%83O%20USINAGEM%3C/text%3E%3C/svg%3E") !important;
  }

  .print-info {
    display:block !important;
    font-size:12px !important;
    color:#000 !important;
  }

  .print-title {
    display:block !important;
    text-align:center !important;
    font-weight:bold !important;
    margin:10px 0 !important;
    color:#000 !important;
  }

  table {
    width:100% !important;
    border-collapse:collapse !important;
    font-size:12px !important;
  }

  th, td {
    border:1px solid #000 !important;
    color:#000 !important;
    text-align:center !important;
    padding:4px !important;
  }
}
</style>
</head>

<body>

<header class="topbar">
  <a href="dashboard.html">
    <button class="btn-voltar">⬅ Voltar ao Menu</button>
  </a>
  <h1 class="topbar-title">Notas Fiscais</h1>
</header>

<div class="print-header">
  <div class="print-logo-box" aria-label="Matão Usinagem"></div>
  <div class="print-info">
    <strong>Relatório:</strong> Notas Fiscais Emitidas<br>
    <strong>Impresso em:</strong> <span id="dh"></span>
  </div>
</div>

<div class="container">
  <section class="card">

    <h2 class="print-title">Notas Fiscais Emitidas</h2>

    <div class="acoes" id="areaBotoes" style="display: flex; gap: 10px;">
      <a href="notas_nova.html">
        <button class="btn-primario" id="btnNovaNF">Lançar Nova NF</button>
      </a>
      <button class="btn-primario" style="background-color: #10b981;" onclick="abrirModalFaturamento()">Faturamento Mensal</button>
    </div>

    <table class="tabela">
      <thead>
        <tr>
          <th>Número</th>
          <th>Cliente</th>
          <th>Data</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="listaNotas">
        <tr>
          <td colspan="4" style="text-align:center;color:#94a3b8;">
            Carregando notas fiscais...
          </td>
        </tr>
      </tbody>
    </table>

  </section>
</div>

<div id="modalFaturamento" class="modal-faturamento">
  <div class="modal-content">
    <div class="modal-header">
      <h3 style="margin:0">Faturamento Mensal</h3>
    </div>
    
    <div class="form-group">
      <label>Mês</label>
      <select id="fatMes">
        <option value="01">Janeiro</option>
        <option value="02">Fevereiro</option>
        <option value="03">Março</option>
        <option value="04">Abril</option>
        <option value="05">Maio</option>
        <option value="06">Junho</option>
        <option value="07">Julho</option>
        <option value="08">Agosto</option>
        <option value="09">Setembro</option>
        <option value="10">Outubro</option>
        <option value="11">Novembro</option>
        <option value="12">Dezembro</option>
      </select>
    </div>

    <div class="form-group">
      <label>Ano</label>
      <input type="number" id="fatAno" value="2026">
    </div>

    <div class="form-group">
      <label>Tipo</label>
      <select id="fatTipo">
        <option value="com_nf">NF</option>
        <option value="sem_nf">Sem NF</option>
        <option value="todos">Todos</option>
      </select>
    </div>

    <button class="btn-calc" onclick="calcularFaturamento()">Calcular Total</button>
    <button class="btn-calc" style="background:#64748b; margin-top:5px;" onclick="fecharModalFaturamento()">Fechar</button>

    <div id="resFaturamento" class="resultado-faturamento" style="display:none;">
      <span>Total Faturado:</span>
      <h2 id="valorTotal" style="margin:5px 0; color:#10b981;">R$ 0,00</h2>
    </div>
  </div>
</div>

<script>
  const agora = new Date();
  document.getElementById("dh").innerText =
    agora.toLocaleDateString("pt-BR") + " " +
    agora.toLocaleTimeString("pt-BR", { hour: '2-digit', minute: '2-digit' });

  // Funções do Modal
  function abrirModalFaturamento() {
    document.getElementById('modalFaturamento').style.display = 'block';
    document.getElementById('fatAno').value = new Date().getFullYear();
    document.getElementById('resFaturamento').style.display = 'none';
  }

  function fecharModalFaturamento() {
    document.getElementById('modalFaturamento').style.display = 'none';
  }

  // Fecha modal ao clicar fora dele
  window.onclick = function(event) {
    let modal = document.getElementById('modalFaturamento');
    if (event.target == modal) modal.style.display = "none";
  }

  function calcularFaturamento() {
    // Essa função será integrada ao seu notas_lista.js para somar os valores reais do banco/lista
    // Por enquanto exibe a área de resultado
    document.getElementById('resFaturamento').style.display = 'block';
    
    // O valor real virá da lógica de filtro no seu arquivo de dados (notas_lista.js)
    // Exemplo: document.getElementById('valorTotal').innerText = "R$ " + totalCalculado.toLocaleString('pt-br', {minimumFractionDigits: 2});
  }
</script>

<script type="module" src="./js/notas_lista.js"></script>
</body>
</html>
