<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Controle de Insertos - Mat√£o Usinagem</title>
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <style>
        .tabela-insertos { width: 100%; border-collapse: collapse; margin-top: 15px; background: #0f172a; border-radius: 8px; overflow: hidden; }
        .tabela-insertos th { background: #1e293b; color: #38bdf8; padding: 12px; text-align: left; }
        .tabela-insertos td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .qtd-alerta { color: #ff4444; font-weight: bold; text-shadow: 0 0 5px rgba(255,0,0,0.5); }
        .btn-mini { padding: 4px 10px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; margin: 0 2px; }
        .btn-mais { background: #22c55e; color: #000; }
        .btn-menos { background: #ef4444; color: #fff; }
    </style>
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="logo-sistema">MAT√ÉO USINAGEM</div>
            <nav class="menu">
                <a href="dashboard.html" class="menu-item">üè† In√≠cio</a>
                <a href="insertos_lista.html" class="menu-item active">üíé Insertos</a>
                <a href="produtos_lista.html" class="menu-item">üì¶ Produtos</a>
            </nav>
        </aside>

        <main class="main">
            <header class="topbar">
                <h1 class="topbar-title">Estoque de Insertos</h1>
                <div class="header-botoes">
                    <button class="btn-primario" onclick="location.href='insertos_novo.html'">+ Novo Inserto</button>
                </div>
            </header>

            <div class="container">
                <section class="card">
                    <table class="tabela-insertos">
                        <thead>
                            <tr>
                                <th>Descri√ß√£o do Inserto</th>
                                <th>Marca</th>
                                <th>Qtd Atual</th>
                                <th>M√≠n.</th>
                                <th>A√ß√µes de Estoque</th>
                            </tr>
                        </thead>
                        <tbody id="listaInsertos">
                            </tbody>
                    </table>
                </section>
            </div>
        </main>
    </div>

    <script type="module">
        import { supabase } from "./js/auth.js";

        async function carregar() {
            const { data } = await supabase.from('insertos').select('*').order('descricao');
            const lista = document.getElementById('listaInsertos');
            lista.innerHTML = data.map(i => `
                <tr style="background-color: ${i.cor_fundo}; color: ${i.cor_fundo !== '#1e293b' ? '#000' : '#fff'}">
                    <td><b>${i.descricao}</b></td>
                    <td>${i.marca || '-'}</td>
                    <td class="${i.quantidade <= i.estoque_minimo ? 'qtd-alerta' : ''}">${i.quantidade}</td>
                    <td>${i.estoque_minimo}</td>
                    <td>
                        <button class="btn-mini btn-mais" onclick="alterar('${i.id}', 1)">+ Inclus√£o</button>
                        <button class="btn-mini btn-menos" onclick="alterar('${i.id}', -1)">- Baixa</button>
                    </td>
                </tr>
            `).join('');
        }

        window.alterar = async (id, valor) => {
            const { data } = await supabase.from('insertos').select('quantidade').eq('id', id).single();
            const novaQtd = data.quantidade + valor;
            if(novaQtd < 0) return;
            await supabase.from('insertos').update({ quantidade: novaQtd }).eq('id', id);
            carregar();
        };

        carregar();
    </script>
</body>
</html>
