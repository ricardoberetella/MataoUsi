<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Zincagem</title>
<link rel="stylesheet" href="css/dashboard.css">
</head>

<body>
<div class="layout">
<aside class="sidebar">
  <div class="logo-sistema">MATÃO USINAGEM</div>
  <nav class="menu">
    <a href="zincagem.html" class="menu-item">⬅ Voltar</a>
  </nav>
</aside>

<main class="main">
<h1 style="color:#38bdf8">Controle de Zincagem</h1>

<input id="filtroOP" placeholder="OP" style="margin-bottom:10px">

<table class="tabela" style="width:100%">
<thead>
<tr><th>Data</th><th>OP</th><th>Produto</th><th>Qtd</th><th>Kg</th><th>Bruto</th><th>Entregue</th><th>Boleto</th></tr>
</thead>
<tbody id="lista"></tbody>
</table>
</main>
</div>

<script type="module">
import { supabase } from "./js/auth.js";

let dados=[];
window.onload=async()=>{
  const {data:{session}}=await supabase.auth.getSession();
  if(!session){location.href="login.html";return;}
  const {data}=await supabase.from("zincagem_tratamento").select("*").order("data",{ascending:false});
  dados=data;
  filtroOP.oninput=render;
  render();
}

function render(){
  const f=filtroOP.value.toLowerCase();
  lista.innerHTML="";
  dados.filter(r=>!f||String(r.op).includes(f)).forEach(r=>{
    lista.innerHTML+=`<tr>
    <td>${r.data}</td><td>${r.op}</td><td>${r.codigo_peca}</td>
    <td>${r.quantidade}</td><td>${r.kg}</td><td>${r.kg_material_bruto}</td>
    <td>${r.entregue?"OK":"Pendente"}</td><td>${r.boleto?"OK":"Pendente"}</td>
    </tr>`;
  });
}
</script>
</body>
</html>
